<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Audio Receiver</title>

  <script src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
</head>
<body>
<script>
  const context = cast.framework.CastReceiverContext.getInstance();
  const playerManager = context.getPlayerManager();

  // Heartbeat
  const NAMESPACE = 'urn:x-cast:com.example.heartbeat';
  let lastHeartbeat = Date.now();

  context.addCustomMessageListener(NAMESPACE, event => {
    if (event.data?.type === 'heartbeat') {
      lastHeartbeat = Date.now();
    }
  });

  setInterval(() => {
    if (Date.now() - lastHeartbeat > 15000) {
      console.log('Heartbeat lost, stopping');
      playerManager.stop();
      context.stop();
    }
  }, 5000);

  context.start();
</script>
</body>
</html>
