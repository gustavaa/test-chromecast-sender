<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript"
      src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js">
  </script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #0f172a; /* slate-900 */
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: #e5e7eb;
    }

    #idle {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      background:
        radial-gradient(circle at top, #1e293b, #020617);
      transition: opacity 300ms ease;
      z-index: 1;
    }

    #connecting {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #1e293b, #020617);
      z-index: 2;
    }

    #idle.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #logo {
      font-size: 48px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    #subtitle {
      margin-top: 12px;
      font-size: 18px;
      opacity: 0.75;
    }

    #hint {
      position: absolute;
      bottom: 48px;
      font-size: 14px;
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div id="idle">
    <div id="logo">Audio Receiver</div>
    <div id="subtitle">Redo att casta</div>
  </div>
  
  <div id="connecting" class="hidden">
    <div id="spinner"></div>
    <div class="text">Ansluterâ€¦</div>
  </div>
<cast-media-player/>
<script>
  const context = cast.framework.CastReceiverContext.getInstance();
  const playerManager = context.getPlayerManager();
  const hearbeatInterval = 15000
  const idle = document.getElementById('idle');
  let showConnecting = false;

  // Heartbeat
  const NAMESPACE = 'urn:x-cast:com.example.heartbeat';
  let lastHeartbeat = Date.now();

  context.addCustomMessageListener(NAMESPACE, event => {
    if (event.data?.type === 'heartbeat') {
      console.log('Received hearbeat');
      lastHeartbeat = Date.now();
    }
  });

  playerManager.addEventListener(
    cast.framework.events.EventType.MEDIA_STATUS,
    event => {
      const state = playerManager.getPlayerState();
      if (state === cast.framework.messages.PlayerState.IDLE) {
        idle.classList.remove('hidden');
      } else {
        idle.classList.add('hidden');
      }
    }
  );

  context.addEventListener(
    cast.framework.events.EventType.SENDER_CONNECTED,
    () => connecting.classList.remove('hidden')
  );
  
  playerManager.addEventListener(
    cast.framework.events.EventType.MEDIA_STATUS,
    () => connecting.classList.add('hidden')
  );

  setInterval(() => {
    if (Date.now() - lastHeartbeat > hearbeatInterval * 3) {
      console.log('Heartbeat lost, stopping');
      playerManager.stop();
    }
  }, hearbeatInterval);

  context.start();
</script>
</body>
</html>
